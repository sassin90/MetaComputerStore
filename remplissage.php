<!DOCTYPE HTML PU leurBLIC "-//W3C//DTD HTML 4.01 Transitional//FR"><html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">	<title>03-09-2012</title>	<link href="style.css" rel="stylesheet" type="text/css">    <meta charset="utf-8"></head><body><script type="text/javascript" src="jquery.min.js" ></script> <br/><br/><table width="100%" border="0" cellspacing="0" cellpadding="0" ><tr>	<td>&nbsp;</td>	<td width="800" class="grisbotle4" >		<table width=100% >			<tr valign=top >				<td align="center" width=80% >					<div id="title" valign=top  align="center">						<a  href="index.php">METACOMPUTER</a>&nbsp;						<b id="id12"> Engineering </b>					</div>				</td>				<td><div style="padding-top:100;border-right:1px dotted #AAA"></td>				<td>					<div id="loogin">					<table valign=top>						<tr valign=top >							<td valign=top >								<form method="post" action="">   									<table width="100%" align="center">										<tr>											<td></td> 											<td><input type="text" size="14" name="nom"  placeholder=Pseudo required /></td>										</tr>										<tr>											<td></td>											<td><input type="password" size="14" name="pass" placeholder=Password  required/></td>										</tr>										<tr>												<td></td>											<td align="center"><input class="bar1" type="submit" value="S'identifier" /></td>										</tr>									</table>								</form>							</td>						</tr>					</table>					</div>				</td>			</tr>		</table>	</td>	<td>&nbsp;</td></tr><tr height=4px">	<td>&nbsp;</td>	<td></td>	<td>&nbsp;</td></tr><tr>	<td>&nbsp;</td>	<td width="800" class="grisbotle4" >		<div style="padding:1px;background-color:#181818"></div>				<div id="bodiv">		<table width="800" align="center"><tr><td class="grisbotle10"><div id="redbotle2" style="color:#111; font-family:'2' "><?phpif(isset($_POST["box"])) {	$box=$_POST["box"];	$total=$_POST["total"];if (isset($_POST['nom']) && isset ($_POST['mail'])&& isset($_POST['password'])){if (($_POST['paiment'] === 'carte' && isset ($_POST['ref'])) OR ($_POST['paiment'] === 'paypal')  ){if(preg_match("#[a-zA-Z0-9._-]+#", $_POST['password']) && preg_match("#[a-zA-Z]+#", $_POST['nom']) && preg_match("#^[a-z0-9._-]+@[a-z._-]{2,}\.[a-z]{2,4}$#", $_POST['mail']) ){$_POST['nom'] = htmlspecialchars($_POST['nom']);$_POST['password'] = htmlspecialchars($_POST['password']);$_POST['mail'] = htmlspecialchars($_POST['mail']);$_POST['adresse'] = htmlspecialchars($_POST['adresse']);$_POST['telephone'] = htmlspecialchars($_POST['telephone']);$_POST['ref'] = htmlspecialchars($_POST['ref']);/*************************************//***   INSERTION DES DONNEES      ***/try{    $pdo_options[PDO::ATTR_ERRMODE] = PDO::ERRMODE_EXCEPTION;    $bdd = new PDO('mysql:host=localhost;dbname=prdOne', 'root', '', $pdo_options);	$reponse=$bdd->prepare("SELECT * FROM client WHERE EMAIL = :EMAIL ");	$reponse->execute(array(	'EMAIL' => $_POST['mail'],	));	if($donnees=$reponse->fetch()) { 		echo '<br/>e-mail ou mots de passe est incorrecte <br/>';		}	else{	/***       l'ajout de client         ***/		$req = $bdd->prepare('INSERT INTO client(NOM, EMAIL, PASSWORD, ADRESSE, TEL) VALUES(:nom, :mail, :pass, :adresse, :tel)');		$req->execute(array(		'nom' => $_POST['nom'],		'mail' => $_POST['mail'],		'pass' => $_POST['password'],		'adresse' => $_POST['adresse'],		'tel' => $_POST['telephone']	));		/***    get idclient  ***/		$get_id_client = $bdd->query('SELECT IDCLIENT FROM client ORDER BY IDCLIENT DESC LIMIT 0,1 ');		while ($ligne = $get_id_client->fetch())	{		$idclient=$ligne['IDCLIENT'];	}	$get_id_client->closeCursor();/***  l'ajout des achats ****/	$boks=$_POST["box"];	foreach($boks as $valeur){		$get_prix_produit = $bdd->query('SELECT PRIX FROM produit WHERE IDPRODUIT=\''.$valeur.'\' ');		while ($ligne = $get_prix_produit->fetch())		{			$prix_produit=$ligne['PRIX'];		}		$reference = $_POST['ref'];		if ($_POST['paiment'] === 'paypal') $reference = 0;		$dat = date("Y/m/d");		$req_achat = $bdd->prepare('INSERT INTO achats(IDPRODUIT, PRIXX	,DATE , TYPEPAIE, REF, VALID, IP) VALUES(:idproduit, :prix, :date, :mode, :ref, :valid, :ip)');			$req_achat->execute(array(			'idproduit' =>  $valeur,			'prix' => $prix_produit,			'date' => $dat,			'mode' =>$_POST['paiment'],			'ref' => $reference,			'valid' => 0,			'ip' => $_SERVER['REMOTE_ADDR']		));		/* get id achat */		$get_id_achat = $bdd->query('SELECT IDACHAT FROM achats ORDER BY IDACHAT DESC LIMIT 0,1 ');		while ($ligne = $get_id_achat->fetch())		{			$idachat=$ligne['IDACHAT'];		}		/*  acheter  */		$req_achat = $bdd->prepare('INSERT INTO acheter(IDCLIENT, IDACHAT) VALUES(:idclient, :idachat)');			$req_achat->execute(array(			'idclient' =>  $idclient,			'idachat'  =>  $idachat ));	}		//header('Location: index.php');		echo '<p>Merci d\'avoir acheter nos produits ! <a href="index.php">retour<a/></p>';	}}	catch(Exception $e){die('Erreur : '.$e->getMessage());}}else echo 'Validation echoué...Remplissez tous les champs correctemment.<br/>';}else echo 'Validation echoué...Veulliez renversez le prix total dans la compte bacancaire de N° : xxxxxxxxx et écrivez le dans le formulaire de validation.<br/>';}else echo 'Validation echoué....<br/>';}else echo 'aucune produit n\'est selectionnée <a href="index.php">retour<a/>';?></div></td></tr></table>	<br/><br/><br/><br/><br/><br/>	<div style="padding-top:13px; border-bottom:1px dotted #AAA"></div><br/>	<div align=left  id="title2"><a style="font-size:20px;color:#666;" href="index.php">El Madhoun Karim</a></div></div></td><td>&nbsp;</td></tr></table><br/><br/><style>	#id8{	font-size:22px;	}	#id8g{	font-size:22px;	color:green;	}	#id12{	font-size:30px;	color:#D01818;	}	#id10{	font-size:22px;	}	#id6{	font-size:18px;	color:#D01818;	}	#id5{	font-size:18px;	color:#555;	}	#bold1,#total{		font-size:14px;		color:#D01818;		font-family:"2";	}	#id4{font-size:14px; font-family:'2'; color:#333;}	#id2{font-size:20px}	#id24{font-size:24px;}	#id21{font-size:21px;}		</style>